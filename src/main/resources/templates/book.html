<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Restaurant</title>

    <link rel="stylesheet" type="text/css" href="/front/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css" crossorigin="anonymous" />
    <link href="/front/css/font-awesome.min.css" rel="stylesheet" />
    <link href="/front/css/style.css" rel="stylesheet" />
    <link href="/front/css/responsive.css" rel="stylesheet" />
</head>

<body class="sub_page">
<main layout:fragment="content">

    <div class="hero_area">
        <div class="bg-box">
            <img src="images/hero-bg.jpg" alt="">
        </div>
    </div>

    <section class="book_section layout_padding">
        <div class="container">
            <div class="heading_container">
                <h2>Rezervasiya</h2>
            </div>
            <div class="row">
                <!-- Rezervasiya formu -->
                <div class="col-md-6">
                    <div class="form_container">
                        <div th:if="${message}" class="alert alert-success">
                            <p th:text="${message}"></p>
                        </div>
                        <div th:if="${error}" class="alert alert-danger">
                            <p th:text="${error}"></p>
                        </div>
                        <form th:action="@{/book/create}" th:object="${reservationDto}" method="post">
                            <div><input type="text" class="form-control" placeholder="Adınız" th:field="*{customerName}" required /></div>
                            <div><input type="text" class="form-control" placeholder="Telefon nömrəniz" th:field="*{customerPhoneNumber}" required /></div>
                            <div><input type="email" class="form-control" placeholder="Email adresiniz" th:field="*{customerEmail}" required /></div>
                            <div><input type="number" class="form-control" placeholder="Adam sayı?" th:field="*{numberOfPeople}" min="1" required /></div>
                            <div><input type="date" class="form-control" th:field="*{reservationDate}" required /></div>
                            <div><input type="time" class="form-control" th:field="*{reservationTime}" required /></div>
                            <div class="btn_box">
                                <button type="submit" class="btn btn-warning py-3 px-5">REZERVASİYA ET</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Sayğac və xəritə -->
                <div class="col-md-6">
                    <div class="wow fadeInUp" data-wow-delay="0.1s">
                        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3039.4283641921825!2d49.83069367566398!3d40.37719775804497!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x40307d0d71e9898b%3A0x2a9847f372425d29!2sIT%20Brains%20Academy!5e0!3m2!1str!2saz!4v1757081670705!5m2!1str!2saz"
                                width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"></iframe>

                        <!-- Sayğac -->
                        <div th:if="${reservationDate}" class="text-center mt-3">
                            <h4 id="countdown-title" class="mb-3">Rezervasiyanıza qalan vaxt:</h4>
                            <div id="countdown-area" class="d-flex justify-content-center">
                                <div class="countdown-box bg-warning text-dark mx-2">
                                    <h3 id="days" class="display-4 font-weight-bold mb-0">00</h3><small>Gün</small>
                                </div>
                                <div class="countdown-box bg-warning text-dark mx-2">
                                    <h3 id="hours" class="display-4 font-weight-bold mb-0">00</h3><small>Saat</small>
                                </div>
                                <div class="countdown-box bg-warning text-dark mx-2">
                                    <h3 id="minutes" class="display-4 font-weight-bold mb-0">00</h3><small>Dəqiqə</small>
                                </div>
                                <div class="countdown-box bg-warning text-dark mx-2">
                                    <h3 id="seconds" class="display-4 font-weight-bold mb-0">00</h3><small>Saniyə</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- Countdown JS -->
<script th:inline="javascript" th:if="${reservationDate}">

    var reservationDateStr = '[[${reservationDate}]]'; // Məsələn: "2025-09-26"
    var reservationTimeStr = '[[${reservationTime}]]'; // Məsələn: "19:00"

    var partsDate = reservationDateStr.split('-');
    var partsTime = reservationTimeStr.split(':');

    // KRİTİK DÜZƏLİŞ: Ayı (Month) 1 çıxaraq təyin edirik
    var reservationDateTime = new Date(
        parseInt(partsDate[0]),         // İl (Məsələn: 2025)
        parseInt(partsDate[1]) - 1,     // AY (Düzəliş: 0-dan başlayır, ona görə -1)
        parseInt(partsDate[2]),         // Gün
        parseInt(partsTime[0]),         // Saat
        parseInt(partsTime[1]),         // Dəqiqə
        0
    ).getTime();

    var x = setInterval(function() {
        var now = new Date().getTime();
        var distance = reservationDateTime - now;

        if (distance < 0) {
            clearInterval(x);
            // Element ID'ləri düzgündürsə, bu hissə görünəcək
            document.getElementById("days").innerHTML = "00";
            // ... və digərlərini də sıfırlayın və ya mesaj göstərin
            return;
        }

        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

        document.getElementById("days").innerHTML = String(days).padStart(2, '0');
        document.getElementById("hours").innerHTML = String(hours).padStart(2, '0');
        document.getElementById("minutes").innerHTML = String(minutes).padStart(2, '0');
        document.getElementById("seconds").innerHTML = String(seconds).padStart(2, '0');
    }, 1000);
</script>
</body>
</html>
